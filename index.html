<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜¿çå°è‚‰ - ç·šä¸Šé»é¤</title>
    <meta property="og:title" content="é˜¿çå°è‚‰ - ç·šä¸Šé»é¤" />
    <meta property="og:description" content="æ¯æ—¥ç¾åšãƒ»å¤æ—©å‘³å‚³æ‰¿ã€‚æ­¡è¿ç·šä¸Šé è¨‚ç¾å‘³å°è‚‰ã€è¹„è†€ï¼" />
    <meta property="og:url" content="https://liff.line.me/2008905608-DekFDzvW" />
    <meta property="og:type" content="website" />

    <meta name="description" content="é˜¿çå°è‚‰æä¾›æ¯æ—¥ç¾åšçš„å¤æ—©å‘³å°è‚‰ã€è¹„è†€èˆ‡è±¬è…³ï¼Œæ­¡è¿ä½¿ç”¨ç·šä¸Šç³»çµ±é è¨‚å–è²¨ã€‚" />

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* â˜… é…è‰²ä¿®æ”¹å€ï¼šæŸ”å’Œå¥¶èŒ¶è‰²ç³» */
        :root {
            --primary-color: #9A7E6F;
            --primary-hover: #826a5c;
            --bg-color: #F8F5F2;
            --card-bg: #ffffff;
            --text-dark: #5D4037;
            --text-light: #8D6E63;
            --card-shadow: 0 4px 15px rgba(154, 126, 111, 0.15);
        }

        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: var(--bg-color); 
            padding-bottom: 110px; 
            color: var(--text-dark); 
        }

        .header-section { position: relative; margin-bottom: -40px; z-index: 1; }
        .header-img { 
            width: 100%; height: 220px; object-fit: cover; 
            border-radius: 0 0 30px 30px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
            filter: brightness(0.95);
        }

        .main-container { max-width: 600px; margin: 0 auto; position: relative; z-index: 2; padding: 0 15px; }

        .content-card { 
            background: var(--card-bg); border-radius: 20px; padding: 25px; 
            box-shadow: var(--card-shadow); margin-bottom: 20px; 
            border: 1px solid #EFEBE9;
        }

        h3 { color: var(--primary-color); font-weight: 700; text-align: center; margin-bottom: 5px; letter-spacing: 1px; }
        .sub-title { text-align: center; color: var(--text-light); font-size: 0.9rem; margin-bottom: 20px; }

        .form-label { font-weight: 700; color: var(--text-dark); margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
        .form-control, .form-select { border-radius: 12px; border: 1px solid #D7CCC8; background-color: #FAFAFA; padding: 12px; color: var(--text-dark); }
        .form-control:focus, .form-select:focus { background-color: #fff; border-color: var(--primary-color); box-shadow: 0 0 0 4px rgba(154, 126, 111, 0.1); }

        .menu-item { display: flex; justify-content: space-between; align-items: center; padding: 18px 0; border-bottom: 1px dashed #D7CCC8; }
        .menu-item:last-child { border-bottom: none; }
        
        .item-name { font-size: 1.15rem; font-weight: bold; color: var(--text-dark); }
        .item-desc { font-size: 0.85rem; color: #9E9E9E; margin-bottom: 2px;}
        .item-price { 
            font-size: 0.95rem; color: var(--primary-color); font-weight: 600; 
            background: #EFEBE9; padding: 2px 8px; border-radius: 6px; display: inline-block;
        }

        .stepper { display: flex; align-items: center; background: #F5F5F5; border-radius: 25px; padding: 3px; }
        .stepper-btn { 
            width: 32px; height: 32px; border-radius: 50%; border: none; 
            background: white; color: var(--primary-color); font-weight: bold; 
            display: flex; align-items: center; justify-content: center; cursor: pointer; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: all 0.2s; touch-action: manipulation; 
        }
        .stepper-btn:active { transform: scale(0.9); }
        .stepper-btn:disabled { background: #e0e0e0; color: #999; cursor: not-allowed; }
        
        .stepper-input { 
            width: 50px; text-align: center; border: 1px solid transparent; background: transparent; 
            font-weight: bold; color: var(--text-dark); pointer-events: auto; border-radius: 4px;
        }
        .stepper-input:focus { background: #fff; border-color: var(--primary-color); outline: none; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

        .bottom-bar { 
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(5px); 
            border-radius: 25px 25px 0 0; padding: 20px; 
            box-shadow: 0 -5px 20px rgba(154, 126, 111, 0.1); z-index: 1000; border-top: 1px solid #EFEBE9;
        }

        .summary-box { margin-bottom: 12px; font-size: 0.95rem; color: var(--primary-color); font-weight: bold; background: #EFEBE9; padding: 10px; border-radius: 10px; text-align: center; }

        .btn-submit { 
            background: var(--primary-color); color: white; border: none; border-radius: 15px; 
            padding: 14px; font-weight: bold; font-size: 1.1rem; 
            box-shadow: 0 4px 12px rgba(154, 126, 111, 0.3); transition: all 0.3s; 
        }
        .btn-submit:hover:not(:disabled) { background-color: var(--primary-hover); transform: translateY(-2px); }
        .btn-submit:disabled { background: #CFD8DC; box-shadow: none; }

        .required::after { content: "*"; color: #D84315; margin-left: 3px; }
        .item-locked { opacity: 0.5; pointer-events: none; }
        .lock-msg { font-size: 0.8rem; color: #D84315; margin-left: 5px; display: none; }
		
		/* --- å…¨é éª¨æ¶å±æ¨£å¼ --- */
		#skeletonOverlay {
			position: fixed;
			top: 0; left: 0;
			width: 100%; height: 100%;
			background-color: var(--bg-color); /* èˆ‡èƒŒæ™¯åŒè‰² */
			z-index: 9998; /* æ¯”æ‰“çƒŠå…¬å‘Š(9999)ä½ä¸€é»ï¼Œä½†è“‹ä½å…§å®¹ */
			overflow-y: scroll; /* å…è¨±æ»¾å‹• */
			padding-bottom: 100px;
		}

		/* é–ƒçˆå‹•ç•« */
		.sk-shimmer {
			background: #E0E0E0;
			background-image: linear-gradient(to right, #E0E0E0 0%, #F5F5F5 20%, #E0E0E0 40%, #E0E0E0 100%);
			background-repeat: no-repeat;
			background-size: 200% 100%; 
			animation: shimmer 1.5s infinite linear;
			border-radius: 8px;
		}

		@keyframes shimmer {
			0% { background-position: -200% 0; }
			100% { background-position: 200% 0; }
		}

		/* æ¨¡æ“¬å„å€‹å€å¡Šå½¢ç‹€ */
		.sk-header { width: 100%; height: 220px; border-radius: 0 0 30px 30px; margin-bottom: 20px; }
		.sk-container { max-width: 600px; margin: 0 auto; padding: 0 15px; }
		.sk-card { background: white; border-radius: 20px; padding: 25px; margin-bottom: 20px; border: 1px solid #EFEBE9; }
		.sk-title { width: 40%; height: 30px; margin: 0 auto 10px; }
		.sk-subtitle { width: 60%; height: 15px; margin: 0 auto 20px; }
		.sk-label { width: 30%; height: 20px; margin-bottom: 10px; }
		.sk-input { width: 100%; height: 45px; margin-bottom: 20px; border-radius: 12px; }
		.sk-menu-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
		.sk-menu-text { width: 50%; }
		.sk-menu-line { height: 15px; margin-bottom: 5px; }
		.sk-menu-btn { width: 100px; height: 35px; border-radius: 20px; }	
    </style>
</head>
<body>

<div id="closedOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); z-index: 9999; text-align: center; padding-top: 150px;">
    <i class="fas fa-store-slash" style="font-size: 5rem; color: #9A7E6F; margin-bottom: 20px;"></i>
    <h2 style="color: #5D4037; font-weight: bold;">æœ¬åº—ä¼‘æ¯ä¸­</h2>
    <p style="color: #8D6E63; font-size: 1.2rem;" id="closedReason">ç›®å‰æš«åœæ¥å–®ï¼Œè«‹ç¨å¾Œå†ä¾†ï¼</p>
</div>

<div id="skeletonOverlay">
    <div class="sk-header sk-shimmer"></div>
    
    <div class="sk-container">
        <div class="sk-card">
            <div class="sk-title sk-shimmer"></div>
            <div class="sk-subtitle sk-shimmer"></div>
            
            <div class="sk-label sk-shimmer"></div>
            <div class="sk-input sk-shimmer"></div>
            
            <div class="sk-label sk-shimmer"></div>
            <div class="sk-input sk-shimmer"></div>
            
            <div class="sk-label sk-shimmer"></div>
            <div class="sk-input sk-shimmer"></div>
        </div>

        <div class="sk-card">
             <div class="sk-menu-row">
                 <div class="sk-menu-text">
                     <div class="sk-menu-line sk-shimmer" style="width: 60%"></div>
                     <div class="sk-menu-line sk-shimmer" style="width: 40%"></div>
                 </div>
                 <div class="sk-menu-btn sk-shimmer"></div>
             </div>
             <div class="sk-menu-row">
                 <div class="sk-menu-text">
                     <div class="sk-menu-line sk-shimmer" style="width: 60%"></div>
                     <div class="sk-menu-line sk-shimmer" style="width: 40%"></div>
                 </div>
                 <div class="sk-menu-btn sk-shimmer"></div>
             </div>
             <div class="sk-menu-row">
                 <div class="sk-menu-text">
                     <div class="sk-menu-line sk-shimmer" style="width: 60%"></div>
                     <div class="sk-menu-line sk-shimmer" style="width: 40%"></div>
                 </div>
                 <div class="sk-menu-btn sk-shimmer"></div>
             </div>
             <div class="sk-menu-row">
                 <div class="sk-menu-text">
                     <div class="sk-menu-line sk-shimmer" style="width: 60%"></div>
                     <div class="sk-menu-line sk-shimmer" style="width: 40%"></div>
                 </div>
                 <div class="sk-menu-btn sk-shimmer"></div>
             </div>
        </div>
    </div>
</div>

<div class="header-section text-center">
    <img src="banner.png" class="header-img" alt="Header">
</div>

<div class="main-container">
    
    <div class="content-card" style="margin-top: 50px;">
        <h3>é˜¿çå°è‚‰</h3>
        <p class="sub-title">æ¯æ—¥ç¾åšãƒ»å¤æ—©å‘³å‚³æ‰¿</p>
        
        <form id="orderForm">
            <div class="mb-3">
                <label class="form-label required"><i class="fas fa-calendar-alt"></i> é å®šå–è²¨æ—¥æœŸ</label>
                <select class="form-select" id="pickupDate">
                    <option value="" disabled selected>è¼‰å…¥ä¸­...</option>
                </select>
                <div id="dateLoadingText" class="form-text text-danger" style="display:none;">ç„¡æ³•è¼‰å…¥æ—¥æœŸï¼Œè«‹é‡æ–°æ•´ç†</div>
            </div>

            <div class="mb-3">
                <label class="form-label required"><i class="fas fa-user"></i> å–è²¨äººå§“å</label>
                <input type="text" class="form-control" id="userNameInput" placeholder="ä¾‹å¦‚ï¼šé™³å°å§">
            </div>

            <div class="mb-1">
                <label class="form-label required"><i class="fas fa-phone-alt"></i> è¯çµ¡é›»è©±</label>
                <input type="tel" class="form-control" id="userPhone" placeholder="09xx-xxx-xxx">
            </div>
        </form>
    </div>

    <div class="content-card">
        <h5 class="mb-4" style="font-weight: bold; color: var(--text-dark); border-left: 5px solid var(--primary-color); padding-left: 12px;">ç¾å‘³èœå–®</h5>
        
        <div class="menu-item">
            <div>
                <div class="item-name">ğŸ– å°è‚‰</div>
                <div class="item-desc">è‚¥è€Œä¸è†©ï¼Œå…¥å£å³åŒ–</div>
                <div class="item-price" id="price_qty_pork">è¼‰å…¥ä¸­...</div>
            </div>
            <div class="stepper">
                <button type="button" class="stepper-btn" onclick="changeQty('qty_pork', -1)"><i class="fas fa-minus"></i></button>
                <input type="number" inputmode="numeric" class="stepper-input" id="qty_pork" value="0" oninput="manualChange(this.id)" onblur="checkEmpty(this.id)">
                <button type="button" class="stepper-btn" onclick="changeQty('qty_pork', 1)"><i class="fas fa-plus"></i></button>
            </div>
        </div>

        <div class="menu-item">
            <div>
                <div class="item-name">ğŸ— è¹„è†€</div>
                <div class="item-desc">çš®è–„è‚‰å«©ï¼Œä¸‹é£¯é¦–é¸</div>
                <div class="item-price" id="price_qty_thigh">è¼‰å…¥ä¸­...</div>
            </div>
            <div class="stepper">
                <button type="button" class="stepper-btn" onclick="changeQty('qty_thigh', -1)"><i class="fas fa-minus"></i></button>
                <input type="number" inputmode="numeric" class="stepper-input" id="qty_thigh" value="0" oninput="manualChange(this.id)" onblur="checkEmpty(this.id)">
                <button type="button" class="stepper-btn" onclick="changeQty('qty_thigh', 1)"><i class="fas fa-plus"></i></button>
            </div>
        </div>

        <div class="menu-item">
            <div>
                <div class="item-name">ğŸ· ç¶œåˆè±¬è…³</div>
                <div class="item-desc">Qå½ˆæœ‰å‹ï¼Œå¯Œå«è† è³ª</div>
                <div class="item-price" id="price_qty_feet">è¼‰å…¥ä¸­...</div>
            </div>
            <div class="stepper">
                <button type="button" class="stepper-btn" onclick="changeQty('qty_feet', -1)"><i class="fas fa-minus"></i></button>
                <input type="number" inputmode="numeric" class="stepper-input" id="qty_feet" value="0" oninput="manualChange(this.id)" onblur="checkEmpty(this.id)">
                <button type="button" class="stepper-btn" onclick="changeQty('qty_feet', 1)"><i class="fas fa-plus"></i></button>
            </div>
        </div>

        <div class="menu-item">
            <div>
                <div class="item-name">ğŸ‹ ç­å¹²</div>
                <div class="item-desc">é®®ç”œå…¥å‘³</div>
                <div class="item-price" id="price_qty_bamboo">è¼‰å…¥ä¸­...</div>
            </div>
            <div class="stepper">
                <button type="button" class="stepper-btn" onclick="changeQty('qty_bamboo', -1)"><i class="fas fa-minus"></i></button>
                <input type="number" inputmode="numeric" class="stepper-input" id="qty_bamboo" value="0" oninput="manualChange(this.id)" onblur="checkEmpty(this.id)">
                <button type="button" class="stepper-btn" onclick="changeQty('qty_bamboo', 1)"><i class="fas fa-plus"></i></button>
            </div>
        </div>

        <div class="menu-item" id="row_extra" style="opacity: 0.6; transition: all 0.3s;">
            <div>
                <div class="item-name">
                    ğŸ¦´ åŠ è³¼è…³è¹„ 
                    <span class="lock-msg" id="lockMsg" style="display:inline-block;">(éœ€è³¼è²·ä¸»é¤)</span>
                </div>
                <div class="item-desc">å–œæ„›å•ƒéª¨é ­çš„å¿…åŠ </div>
                <div class="item-price" id="price_qty_extra">è¼‰å…¥ä¸­...</div>
            </div>
            <div class="stepper">
                <button type="button" class="stepper-btn btn-extra" disabled onclick="changeQty('qty_extra', -1)"><i class="fas fa-minus"></i></button>
                <input type="number" inputmode="numeric" class="stepper-input" id="qty_extra" value="0" oninput="manualChange(this.id)" onblur="checkEmpty(this.id)" disabled>
                <button type="button" class="stepper-btn btn-extra" disabled onclick="changeQty('qty_extra', 1)"><i class="fas fa-plus"></i></button>
            </div>
        </div>

        <div class="mt-4">
            <label class="form-label"><i class="fas fa-edit"></i> å‚™è¨»éœ€æ±‚</label>
            <textarea class="form-control" id="note" rows="2" placeholder="ä¾‹å¦‚ï¼šç˜¦è‚‰å¤šã€è¹„æ—å¤§ä¸€é»..."></textarea>
        </div>
        
        <div class="mt-3 text-center text-muted small">
            <i class="fas fa-info-circle"></i> åƒ¹æ ¼åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›é‡‘é¡ä¾ç¾å ´ç§¤é‡ç‚ºä¸»
        </div>
    </div>
</div>

<div class="bottom-bar">
    <div id="summaryDisplay" class="summary-box" style="display: none;"></div>
    <button type="button" class="btn btn-primary w-100 btn-submit" onclick="submitOrder()">
        ç¢ºèªé€å‡ºè¨‚å–® <i class="fas fa-paper-plane ms-2"></i>
    </button>
</div>

<input type="hidden" id="userId">

<script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<script>
    // â˜…â˜…â˜… è«‹æ›¿æ›æˆæ‚¨çš„è¨­å®š â˜…â˜…â˜…
    const API_URL = "https://script.google.com/macros/s/AKfycbwEcfD-U0gUFQtBvL2WgQfh6gQIaMekVYOyUOimwvYFVcNN6QGv9KjRuM4NrFWIEFqf/exec";  
    const LIFF_ID = "2008905608-DekFDzvW"; 
    
    // å…¨åŸŸè®Šæ•¸ï¼šå„²å­˜å¾ Excel æŠ“ä¸‹ä¾†çš„èœå–®åƒ¹æ ¼
    let GLOBAL_MENU = {};

    window.onload = function() {
        liff.init({ liffId: LIFF_ID }).then(() => {
            if (liff.isLoggedIn()) {
                liff.getProfile().then(profile => {
                    document.getElementById('userId').value = profile.userId;
                    document.getElementById('userNameInput').value = profile.displayName;
                });
            } else {
                liff.login();
            }
        });
        
        // åˆå§‹åŒ–ç³»çµ± (æŠ“æ—¥æœŸ + æŠ“èœå–®)
        initSystem();
        
        checkAddonAvailability();
    };

    function initSystem() {
        const dateSelect = document.getElementById('pickupDate');
        
        fetch(API_URL) 
        .then(response => response.json())
        .then(data => {
            // --- 1. è™•ç†æ—¥æœŸ ---
            if (data.dates.length === 0) {
                 // å¦‚æœæ²’æ—¥æœŸï¼Œé¡¯ç¤ºæ‰“çƒŠï¼Œä¸¦éš±è—éª¨æ¶å±
                 document.getElementById('closedOverlay').style.display = 'block';
                 document.getElementById('closedReason').innerText = "ç›®å‰ç„¡é–‹æ”¾æ—¥æœŸï¼Œè«‹ç¨å¾Œå†ä¾†ï¼";
                 document.getElementById('skeletonOverlay').style.display = 'none'; // éš±è—éª¨æ¶
                 return;
            } else {
                 document.getElementById('closedOverlay').style.display = 'none';
                 
                 // â˜…â˜…â˜… é—œéµä¿®æ­£ï¼šå…ˆæ¸…ç©ºåŸæœ¬çš„ã€Œè¼‰å…¥ä¸­...ã€ï¼Œæ”¹æˆã€Œè«‹é¸æ“‡ã€ â˜…â˜…â˜…
                 dateSelect.innerHTML = '<option value="" disabled selected>è«‹é¸æ“‡å–è²¨æ—¥æœŸ</option>';
                 
                 // æŠŠå¾Œç«¯æŠ“åˆ°çš„æ—¥æœŸä¸€å€‹ä¸€å€‹å¡é€²å»
                 data.dates.forEach(item => {
                    let option = document.createElement("option");
                    option.value = item.value; 
                    option.text = item.text;   
                    if (item.disabled) option.disabled = true; 
                    dateSelect.add(option);
                });
            }

            // --- 2. è™•ç†èœå–®åƒ¹æ ¼ ---
            // â˜…â˜…â˜… é—œéµä¿®æ­£ï¼šé€™è£¡åŸæœ¬è¢«çœç•¥äº†ï¼Œå¿…é ˆè£œå›ä¾†æ‰èƒ½æ›´æ–°åƒ¹æ ¼ â˜…â˜…â˜…
            if (data.menu) {
                GLOBAL_MENU = data.menu; // å­˜åˆ°å…¨åŸŸè®Šæ•¸
                
                // è‡ªå‹•æ›´æ–°ç¶²é ä¸Šçš„åƒ¹æ ¼é¡¯ç¤ºï¼ŒæŠŠã€Œè¼‰å…¥ä¸­...ã€æ›æˆã€Œ$350ã€
                for (const [key, item] of Object.entries(GLOBAL_MENU)) {
                    let priceDiv = document.getElementById('price_' + key);
                    if (priceDiv) {
                        if (item.min === item.max) {
                            priceDiv.innerText = `$${item.min} / ä»½`;
                        } else {
                            priceDiv.innerText = `$${item.min} ~ $${item.max} / ä»½`;
                        }
                    }
                }
            }

            // --- 3. å…¨éƒ¨æ›´æ–°å®Œç•¢ï¼Œç§»é™¤éª¨æ¶å± ---
            // åŠ ä¸€é»é»å»¶é²(300ms)è®“è½‰æ›æ›´å¹³æ»‘ï¼Œä¸æœƒé–ƒä¸€ä¸‹
            setTimeout(() => {
                document.getElementById('skeletonOverlay').style.display = 'none';
            }, 300);
        })
        .catch(err => {
            console.error("è¼‰å…¥å¤±æ•—", err);
            dateSelect.innerHTML = '<option value="" disabled>è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†</option>';
            // ç™¼ç”ŸéŒ¯èª¤ä¹Ÿè¦æŠŠéª¨æ¶é—œæ‰ï¼Œä¸ç„¶å®¢äººæœƒå¡åœ¨å‡ç•«é¢
            document.getElementById('skeletonOverlay').style.display = 'none';
        });
    }

    function checkAddonAvailability() {
        let mainQty = (parseInt(document.getElementById('qty_pork').value) || 0) +
                      (parseInt(document.getElementById('qty_thigh').value) || 0) +
                      (parseInt(document.getElementById('qty_feet').value) || 0);

        const extraRow = document.getElementById('row_extra');
        const extraBtns = document.querySelectorAll('.btn-extra');
        const extraInput = document.getElementById('qty_extra');
        const lockMsg = document.getElementById('lockMsg');

        if (mainQty > 0) {
            extraRow.style.opacity = '1';
            lockMsg.style.display = 'none';
            extraBtns.forEach(btn => btn.disabled = false);
            extraInput.disabled = false;
        } else {
            extraRow.style.opacity = '0.6';
            lockMsg.style.display = 'inline-block';
            extraBtns.forEach(btn => btn.disabled = true);
            extraInput.disabled = true;
            extraInput.value = 0; 
        }
        updateSummary(); 
    }

    function changeQty(id, delta) {
        const input = document.getElementById(id);
        let currentVal = parseInt(input.value) || 0;
        let newVal = currentVal + delta;
        if (newVal < 0) newVal = 0;
        if (newVal > 50) newVal = 50;
        input.value = newVal;
        checkAddonAvailability();
    }

    function manualChange(id) {
        const input = document.getElementById(id);
        let val = parseInt(input.value);
        if (isNaN(val)) return;
        if (val < 0) input.value = 0;
        if (val > 50) input.value = 50;
        checkAddonAvailability();
    }

    function checkEmpty(id) {
        const input = document.getElementById(id);
        if (input.value === "" || isNaN(parseInt(input.value))) {
            input.value = 0;
            checkAddonAvailability();
        }
    }

    function updateSummary() {
        // ç‚ºäº† summaryï¼Œæˆ‘å€‘éœ€è¦çŸ¥é“å“é …åç¨±ï¼Œå¦‚æœ Excel é‚„æ²’è¼‰å…¥å®Œï¼Œå°±å…ˆç”¨é è¨­åç¨±
        let items = [
            {id: 'qty_pork', name: 'å°è‚‰'},
            {id: 'qty_thigh', name: 'è¹„è†€'},
            {id: 'qty_feet', name: 'è±¬è…³'},
            {id: 'qty_bamboo', name: 'ç­å¹²'},
            {id: 'qty_extra', name: 'åŠ è³¼è…³è¹„'}
        ];

        let summary = [];
        items.forEach(item => {
            let val = parseInt(document.getElementById(item.id).value) || 0;
            if (val > 0) {
                // å¦‚æœ Excel æœ‰åå­—å°±ç”¨ Excel çš„ï¼Œä¸ç„¶ç”¨é è¨­çš„
                let displayName = (GLOBAL_MENU[item.id]) ? GLOBAL_MENU[item.id].name : item.name;
                summary.push(`${displayName}x${val}`);
            }
        });

        let displayDiv = document.getElementById('summaryDisplay');
        if (summary.length > 0) {
            displayDiv.style.display = 'block';
            displayDiv.innerHTML = "ğŸ›’ ç›®å‰é¸æ“‡ï¼š " + summary.join('ã€');
        } else {
            displayDiv.style.display = 'none';
        }
    }

    function submitOrder() {
        let qty_pork = document.getElementById('qty_pork').value;
        let qty_thigh = document.getElementById('qty_thigh').value;
        let qty_feet = document.getElementById('qty_feet').value;
        let qty_bamboo = document.getElementById('qty_bamboo').value;
        let qty_extra = document.getElementById('qty_extra').value;

        let manualName = document.getElementById('userNameInput').value;
        let userPhone = document.getElementById('userPhone').value;
        let noteInput = document.getElementById('note').value;
        
        let pickupDateSelect = document.getElementById('pickupDate'); 
        let pickupDate = pickupDateSelect.value;
        
        if (!pickupDate) { alert("è«‹é¸æ“‡é å®šå–è²¨æ—¥æœŸå–”ï¼ğŸ“…"); pickupDateSelect.focus(); return; }

        let selectedOptionText = pickupDateSelect.options[pickupDateSelect.selectedIndex].text;
        if (selectedOptionText.includes("(å·²é¡æ»¿)") || selectedOptionText.includes("(å·²æˆªæ­¢)")) {
            alert("æŠ±æ­‰ï¼è©²æ—¥æœŸå·²é¡æ»¿æˆ–æˆªæ­¢ï¼Œç„¡æ³•ä¸‹å–® ğŸ˜­");
            return; 
        }

        if (!manualName) { alert("è«‹å¡«å¯«å–è²¨äººå§“åï¼ğŸ‘¤"); document.getElementById('userNameInput').focus(); return; }
        if (!userPhone) { alert("è«‹å¡«å¯«è¯çµ¡é›»è©±ï¼ğŸ“"); document.getElementById('userPhone').focus(); return; }
        
        if (qty_pork==0 && qty_feet==0 && qty_thigh==0 && qty_bamboo==0 && qty_extra==0) { 
            alert("ğŸ˜… è³¼ç‰©è»Šæ˜¯ç©ºçš„å–”ï¼"); return; 
        }

        const orderData = {
            pickupDate: pickupDate,
            userName: manualName,
            userPhone: userPhone,
            qty_pork: qty_pork,
            qty_thigh: qty_thigh,
            qty_feet: qty_feet,
            qty_bamboo: qty_bamboo,
            qty_extra: qty_extra, 
            note: noteInput
        };

        // â˜…â˜…â˜… ä½¿ç”¨ Excel çš„åƒ¹æ ¼ä¾†ç”¢ç”Ÿå­˜æ ¹è¯ â˜…â˜…â˜…
        let receiptItems = [];
        let itemsToCheck = ['qty_pork', 'qty_thigh', 'qty_feet', 'qty_bamboo', 'qty_extra'];
        
        itemsToCheck.forEach(key => {
            let qty = parseInt(document.getElementById(key).value) || 0;
            if (qty > 0) {
                // å¾å…¨åŸŸè®Šæ•¸æŠ“ Excel çš„è¨­å®š
                let itemData = GLOBAL_MENU[key];
                if (itemData) {
                    let priceStr = "";
                    if (itemData.min === itemData.max) {
                        priceStr = `$${itemData.min * qty}`;
                    } else {
                        priceStr = `ç´„$${itemData.min * qty}~$${itemData.max * qty}`;
                    }
                    receiptItems.push(`${itemData.name} x${qty} (${priceStr})`);
                } else {
                    // è¬ä¸€ Excel æ²’è¼‰å…¥æˆåŠŸï¼Œè‡³å°‘é¡¯ç¤ºæ•¸é‡
                    receiptItems.push(`å“é …(${key}) x${qty}`);
                }
            }
        });

        let receiptText = `ã€é˜¿çå°è‚‰ - è¨‚è³¼æˆåŠŸã€‘\n` +
                          `ğŸ“… å–è²¨æ—¥æœŸï¼š${pickupDate}\n` +
                          `ğŸ‘¤ å–è²¨äººï¼š${manualName}\n` +
                          `------------------\n` +
                          `${receiptItems.join('\n')}\n` +
                          `------------------\n` +
                          `ğŸ“ é›»è©±ï¼š${userPhone}\n` +
                          `ğŸ“ å‚™è¨»ï¼š${noteInput || 'ç„¡'}\n\n` +
                          `â€» åƒ¹æ ¼åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›é‡‘é¡ä¾ç¾å ´ç§¤é‡ç‚ºä¸»ã€‚\n` + 
                          `å·²æ”¶åˆ°æ‚¨çš„è¨‚å–®ï¼Œç•¶å¤©è¦‹ï¼â¤ï¸`;

        const btn = document.querySelector('.btn-submit');
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> è™•ç†ä¸­...';
        btn.disabled = true;

        fetch(API_URL, {
            method: "POST",
            body: JSON.stringify(orderData)
        })
        .then(response => response.json())
        .then(data => {
            if (liff.isInClient()) {
                liff.sendMessages([{ type: 'text', text: receiptText }])
                .then(() => {
                    alert("âœ… è¨‚è³¼æˆåŠŸï¼LINE èŠå¤©å®¤å·²å‚³é€è¨‚å–®æ˜ç´°ã€‚");
                    liff.closeWindow();
                })
                .catch((err) => {
                    alert("âœ… è¨‚è³¼æˆåŠŸï¼");
                    liff.closeWindow();
                });
            } else {
                alert("âœ… è¨‚è³¼æˆåŠŸï¼");
                window.location.reload(); 
            }
        })
        .catch(error => {
            alert("âŒ ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
            btn.innerHTML = 'ç¢ºèªé€å‡ºè¨‚å–®';
            btn.disabled = false;
        });
    }
</script>

</body>
</html>


